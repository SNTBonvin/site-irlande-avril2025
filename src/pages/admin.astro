---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const articles = await getCollection("articles");
const sorted = articles.sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);


---

<Layout>
  <section class="max-w-4xl mx-auto py-10">
    <h1 class="text-3xl font-bold mb-6">🛠️ Administration des articles</h1>

    <div class="mb-6">
      <a
        href="/admin/new"
        class="bg-[#169B62] text-white px-4 py-2 rounded hover:bg-green-700 transition"
      >
        ➕ Nouvel article
      </a>
    </div>

    <ul class="space-y-4">
      {sorted.map(({ slug, data }) => (
        <li class="border p-4 rounded-md shadow-md">
          <h2 class="text-xl font-semibold">{data.title}</h2>
          <p class="text-sm text-gray-500">📅 {data.pubDate}</p>
          <div class="mt-2">
            <form
              method="POST"
              action={`/admin/delete/${slug}`}
              onsubmit="return confirm('Confirmer la suppression de cet article ?')"
            >
              <button
                type="submit"
                class="text-red-600 hover:underline"
              >
                🗑️ Supprimer
              </button>
            </form>
          </div>
        </li>
      ))}
    </ul>
  </section>
</Layout>
