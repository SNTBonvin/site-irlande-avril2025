---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

const articles = await getCollection("articles");
const sorted = articles.sort(
  (a, b) => new Date(b.data.pubDate) - new Date(a.data.pubDate)
);
---

<Layout>
  <section class="max-w-4xl mx-auto py-10">
    <h1 class="text-3xl font-bold mb-6">🛠️ Administration des articles</h1>
    <ul class="space-y-4">
      {sorted.map(({ slug, data }) => (
        <li class="border p-4 rounded-md shadow-md">
          <h2 class="text-xl font-semibold">{data.title}</h2>
          <p class="text-sm text-gray-500">{data.pubDate}</p>
          <div class="mt-2 flex gap-4">
  <a
    href={`/articles/${slug}/`}
    class="text-blue-600 hover:underline"
    target="_blank"
  >
    🔎 Voir
  </a>
  <a
    href={`/admin/edit/${slug}`}
    class="text-yellow-600 hover:underline"
  >
    ✏️ Éditer
  </a>

  <form method="POST" action={`/admin/delete/${slug}`} onsubmit="return confirm('Supprimer cet article ?')" class="inline">
    <button
      type="submit"
      class="text-red-600 hover:underline bg-transparent border-0 p-0 cursor-pointer"
    >
      🗑️ Supprimer
    </button>
  </form>
</div>

        </li>
      ))}
    </ul>
  </section>
</Layout>
